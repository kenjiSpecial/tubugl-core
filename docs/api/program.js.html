<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>program.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ArrayBuffer.html">ArrayBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ArrayBuffer.html#attribPointer">attribPointer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ArrayBuffer.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ArrayBuffer.html#disablePoiner">disablePoiner</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ArrayBuffer.html#setAttribs">setAttribs</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ArrayBuffer.html#setData">setData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ArrayBuffer.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="FrameBuffer.html">FrameBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FrameBuffer.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FrameBuffer.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FrameBuffer.html#makeDepthBUffer">makeDepthBUffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FrameBuffer.html#reset">reset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FrameBuffer.html#unbind">unbind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FrameBuffer.html#updateSize">updateSize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FrameBuffer.html#updateViewport">updateViewport</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="IndexArrayBuffer.html">IndexArrayBuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexArrayBuffer.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexArrayBuffer.html#setData">setData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="IndexArrayBuffer.html#unbind">unbind</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Program.html">Program</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#dispose">dispose</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#getAttrib">getAttrib</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#getUniforms">getUniforms</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#initProgram">initProgram</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#setUniformTexture">setUniformTexture</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#use">use</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Texture.html">Texture</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#activeTexture">activeTexture</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#delete">delete</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#fromData">fromData</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#fromImage">fromImage</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#fromSize">fromSize</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#generateMipmap">generateMipmap</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#getTexture">getTexture</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#isActiveTexture">isActiveTexture</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#setFilter">setFilter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#setFlip">setFlip</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#setFormat">setFormat</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#setMagFilter">setMagFilter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#setMinFilter">setMinFilter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#setPixelStore">setPixelStore</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#unbind">unbind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Texture.html#wrap">wrap</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Uniform.html">Uniform</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Uniform.html#update">update</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#GLenum">GLenum</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#WebGLFramebuffer">WebGLFramebuffer</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#WebGLTexture">WebGLTexture</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">program.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { webGLShader } from './utils/webglShader';
import { Uniform } from './uniform';
import {
	FLOAT,
	FLOAT_VEC2,
	FLOAT_VEC3,
	FLOAT_VEC4,
	TEXTURE_2D,
	SAMPLER_2D,
	VERTEX_SHADER,
	FRAGMENT_SHADER,
	LINK_STATUS,
	ACTIVE_UNIFORMS,
	ACTIVE_ATTRIBUTES,
	FLOAT_MAT2,
	FLOAT_MAT3,
	FLOAT_MAT4
} from 'tubugl-constants';

export class Program {
	/**
	 * constructor
	 * compile shaders and link them to gl context
	 *
	 * @param {WebGLRenderingContext} gl
	 * @param {string} vertSrc
	 * @param {string} fragSrc
	 * @param {Object} params
	 * @param {booean} params.isDebug
	 *
	 * @constructor Program
	 */
	constructor(gl, vertSrc, fragSrc, params = {}) {
		/**
		 * @private
		 * @member {boolean}
		 */
		this._isReady = false;
		/**
		 * @private
		 * @member {boolean}
		 */
		this._isDebgu = params.isDebug;

		/**
		 * @private
		 * @member {WebGLRenderingContext}
		 */
		this._gl = gl;

		if (vertSrc &amp;&amp; fragSrc) {
			this.initProgram(vertSrc, fragSrc, params);
		}
	}

	/**
	 * crate the program and compile shader
	 *
	 * @param {string} vertSrc vertex hader
	 * @param {string} fragSrc fragment shader src
	 * @param {Object} params optinal paramters
	 */
	initProgram(vertSrc, fragSrc, params = {}) {
		/**
		 * @description vertexShader
		 * @private
		 * @member {WebGLShader}
		 */
		this._vertexShader = webGLShader(this._gl, VERTEX_SHADER, vertSrc);
		/**
		 * @description fragmentShader
		 * @private
		 * @member {WebGLShader}
		 */
		this._fragmentShader = webGLShader(this._gl, FRAGMENT_SHADER, fragSrc);
		/**
		 * @description program
		 * @private
		 * @member {WebGLProgram}
		 */
		this._program = this._gl.createProgram();
		this._gl.attachShader(this._program, this._vertexShader);
		this._gl.attachShader(this._program, this._fragmentShader);
		this._gl.linkProgram(this._program);

		try {
			let success = this._gl.getProgramParameter(this._program, LINK_STATUS);
			if (!success) throw this._gl.getProgramInfoLog(this._program);
		} catch (error) {
			console.error(`WebGLProgram: ${error}`);
		}

		this._setProperties();
	}

	/**
	 * set properties such as uniforms and attributes
	 * @private
	 */
	_setProperties() {
		let ii;

		// uniforms
		const uniformNumber = this._gl.getProgramParameter(this._program, ACTIVE_UNIFORMS);

		/**
		 * @member {object}
		 */
		this.uniform = {};
		for (ii = 0; ii &lt; uniformNumber; ii++) {
			let uniformInfo = this._gl.getActiveUniform(this._program, ii);
			this.uniform[uniformInfo.name] = new Uniform(this._gl, this._program, uniformInfo);
		}

		//attributes
		const attributreNumber = this._gl.getProgramParameter(this._program, ACTIVE_ATTRIBUTES);
		/**
		 * @member {object}
		 */
		this.attrib = {};
		for (ii = 0; ii &lt; attributreNumber; ii++) {
			let attrib = this._gl.getActiveAttrib(this._program, ii);
			this.attrib[attrib.name] = {
				location: this._gl.getAttribLocation(this._program, attrib.name),
				type: attrib.type,
				size: attrib.size
			};
		}

		return this;
	}

	/**
	 * use program, as same function as bind()
	 */
	use() {
		return this.bind();
	}

	/**
	 * use program, as same function as use()
	 */
	bind() {
		this._gl.useProgram(this._program);
		return this;
	}

	/**
	 * get the value of the attribute of program(it will be remove)
	 *
	 * @param {string} name name of attributes
	 */
	getAttrib(name) {
		return this.attrib[name];
	}

	/**
	 * get the value of uniform of program(it will be removed)
	 * @param {string} name name of uniforms
	 */
	getUniforms(name) {
		return this.uniform[name];
	}
	/**
	 * set texture as uniform
	 * @param {Texture} texture
	 * @param {String} uniformName
	 */
	setUniformTexture(texture, uniformName) {
		let { textureNum } = texture;
		this.uniform[uniformName].update(textureNum);
	}

	/**
	 * dispose program
	 */
	dispose() {
		if (this._gl === null) return;

		this._gl.deleteProgram(this._program);
		this._gl.deleteShader(this._vertexShader);
		this._gl.deleteShader(this._fragmentShader);
		this._gl = null;
	}
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Feb 11 2018 11:03:23 GMT+0100 (W. Europe Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
