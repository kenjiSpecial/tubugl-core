<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>program.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Program.html">Program</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#_initProgram">_initProgram</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#bind">bind</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#dispose">dispose</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#getAttrib">getAttrib</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#getUniforms">getUniforms</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#setUniformTexture">setUniformTexture</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Program.html#use">use</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">program.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { webGLShader } from './utils/webglShader';
import {
	FLOAT,
	FLOAT_VEC2,
	FLOAT_VEC3,
	FLOAT_VEC4,
	TEXTURE_2D,
	SAMPLER_2D
} from 'tubugl-constants';
import { FLOAT_MAT2, FLOAT_MAT3, FLOAT_MAT4 } from 'tubugl-constants';
import {
	VERTEX_SHADER,
	FRAGMENT_SHADER,
	LINK_STATUS,
	ACTIVE_UNIFORMS,
	ACTIVE_ATTRIBUTES
} from 'tubugl-constants';

export class Program {
	/**
	 * constructor
	 * compile shaders and link them to gl context
	 *
	 * @param {WebGLRenderingContext} gl
	 * @param {string} vertSrc
	 * @param {string} fragSrc
	 * @param {Object} params
	 * @param {booean} params.isDebug
	 *
	 * @constructor Program
	 */
	constructor(gl, vertSrc, fragSrc, params = {}) {
		this._isReady = false;
		this._isDebgu = params.isDebug;

		this._gl = gl;

		if (vertSrc &amp;&amp; fragSrc) {
			this.initProgram(vertSrc, fragSrc, params);
		}
	}

	/**
	 * crate the program and compile shader
	 *
	 * @param {string} vertSrc vertex hader
	 * @param {string} fragSrc fragment shader src
	 * @param {Object} params optinal paramters
	 */
	_initProgram(vertSrc, fragSrc, params = {}) {
		this._vertexShader = webGLShader(this._gl, VERTEX_SHADER, vertSrc);
		this._fragmentShader = webGLShader(this._gl, FRAGMENT_SHADER, fragSrc);
		this._program = this._gl.createProgram();
		this._gl.attachShader(this._program, this._vertexShader);
		this._gl.attachShader(this._program, this._fragmentShader);
		this._gl.linkProgram(this._program);

		try {
			let success = this._gl.getProgramParameter(this._program, LINK_STATUS);
			if (!success) throw this._gl.getProgramInfoLog(this._program);
		} catch (error) {
			console.error(`WebGLProgram: ${error}`);
		}

		this._setProperties();
	}

	/**
	 * set properties such as uniforms and attributes
	 * @private
	 */
	_setProperties() {
		let ii;

		// uniforms
		const uniformNumber = this._gl.getProgramParameter(this._program, ACTIVE_UNIFORMS);

		this._uniform = {};
		for (ii = 0; ii &lt; uniformNumber; ii++) {
			let uniform = this._gl.getActiveUniform(this._program, ii);
			let uLocation = this._gl.getUniformLocation(this._program, uniform.name);

			let typeName;
			/**
			 * https://developer.mozilla.org/en-US/docs/Web/API/WebGL_API/Constants
			 * */
			switch (uniform.type) {
				case FLOAT:
					typeName = 'float';
					break;
				case FLOAT_VEC2:
					typeName = 'vec2';
					break;
				case FLOAT_VEC3:
					typeName = 'vec3';
					break;
				case FLOAT_VEC4:
					typeName = 'vec4';
					break;
				case FLOAT_MAT2:
					typeName = 'mat2';
					break;
				case FLOAT_MAT3:
					typeName = 'mat3';
					break;
				case FLOAT_MAT4:
					typeName = 'mat4';
					break;
				case SAMPLER_2D:
					typeName = 'sampler2D';
					break; // TODO Do we need to some method or not
			}

			this._uniform[uniform.name] = {
				location: uLocation,
				type: uniform.type,
				typeName: typeName,
				size: uniform.size
			};
		}

		//attributes
		const attributreNumber = this._gl.getProgramParameter(this._program, ACTIVE_ATTRIBUTES);
		this._attrib = {};
		for (ii = 0; ii &lt; attributreNumber; ii++) {
			let attrib = this._gl.getActiveAttrib(this._program, ii);
			this._attrib[attrib.name] = {
				location: this._gl.getAttribLocation(this._program, attrib.name),
				type: attrib.type,
				size: attrib.size
			};
		}

		return this;
	}

	/**
	 * use program, as same function as bind()
	 */
	use() {
		return this.bind();
	}

	/**
	 * use program, as same function as use()
	 */
	bind() {
		this._gl.useProgram(this._program);
		return this;
	}

	/**
	 * get the value of the attribute of program(it will be remove)
	 *
	 * @param {string} name name of attributes
	 */
	getAttrib(name) {
		return this.attrib[name];
	}

	/**
	 * get the value of uniform of program(it will be removed)
	 * @param {string} name name of uniforms
	 */
	getUniforms(name) {
		return this.uniform[name];
	}
	/**
	 * set texture as uniform
	 * @param {Texture} texture
	 * @param {String} uniformName
	 */
	setUniformTexture(texture, uniformName) {
		let { textureNum } = texture;
		let uniform = this.getUniforms(uniformName);
		// console.log(textureNum);
		this._gl.uniform1i(uniform.location, textureNum);
	}

	/**
	 * dispose program
	 */
	dispose() {
		if (this._gl === null) return;

		this._gl.deleteProgram(this._program);
		this._gl.deleteShader(this._vertexShader);
		this._gl.deleteShader(this._fragmentShader);
		this._gl = null;
	}
}
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sat Feb 10 2018 14:25:39 GMT+0100 (W. Europe Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
